---
description: Ship a true NFT Marketplace on Celo - Part 2
---

# NFT - Indexing - Graph

<figure><img src=".gitbook/assets/image (3).png" alt=""><figcaption></figcaption></figure>

For our NFT marketplace to show all listings on the marketplace, we need to somehow keep track of the current active listings. This is where The Graph comes in!

The Graph is an indexer and decentralized query protocol for the blockchain. Basically, it can track events being emitted in real time, and transform that data by running user-defined scripts, and make it available through a simple GraphQL API.

> NOTE : We also cover The Graph in the Junior Track of Fundamentals. Check that out if you want another example of it's usage

The main motivation for us to use The Graph is because we require a way to fetch a list of all active listings from our contract. Since in the contract itself, listings are stored within a 2D mapping _(Remember `mapping(address => mapping(uint256 => Listing)) public listings;`)_, it is impossible to know what key-value pairs exist within the mapping since the possibilities are too large, and there is no way to just find values that exist within mappings and ignore the 'unset' values.

Meaning, we do not have the contract addresses nor the token IDs stored to loop over the mapping to get all the values we need. Now you can ask, 'why not store those values in the contract as well?'. The answer to that is, we should not, because it uses alot of gas to store when we can use events for our advantage.

The Graph will allow us to use the events we emit from the smart contract to build up kind of a database of all listings, which we can create, read, update, and delete from. We can then just get a list of all listings by querying the database through it's GraphQL API.

***

### Subgraph Development

The way to utilize The Graph's technology is to build your own "subgraph" - a project that defines your data transformation scripts, which contract and which network you want to track, which events you want to index, and how you want the GraphQL API to expose your data.

#### 🧶 Installing Yarn

The Graph requires using `yarn` to install dependencies. `yarn` is an alternative package manager for Node.js, similar to `npm`.

If you don't have `yarn` installed on your computer, you can install it by running the following command:

```
npm install -g yarn
```

#### 👨‍🔬 Setting Up

Let's create a new folder and set up a Graph project in there.

1. Open up a terminal, and install the Graph CLI on your computer globally

```
yarn global add @graphprotocol/graph-cli
```

2. Enter the `celo-nft-marketplace` directory from your terminal

```
cd celo-nft-marketplace
```

3. Initialize a new subgraph project by running the following command.

```
graph init
```

4. Select `ethereum` as the protocol when the CLI prompts you to choose.
5. Select `hosted-service` for the Product.
6. Enter your subgraph name that follows the format `GITHUB_USERNAME/celo-nft-marketplace`. **Replace `GITHUB_USERNAME` with your Github username**.
7. Enter `subgraph` for the Directory to create the subgraph in.
8. Select `celo-alfajores` for the network.
9. Input the contract address of your NFT Marketplace contract as deployed in Part 1. _If you do not have it saved, you can just re-deploy the contract again._
10. Enter `./hardhat/artifacts/contracts/NFTMarketplace.sol/NFTMarketplace.json` for the ABI path - this refers to the ABI generated by Hardhat when you compile the contracts in Part 1.
11. Enter `NFTMarketplace` for the Contract Name.
12. Wait for the CLI to set up your project.

> HELP : For instances where you get errors, try installing the CLI using npm : `npm i -g @graphprotocol/graph-cli`
